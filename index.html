<!-- index.html - Kode Lengkap dengan Update Label dan Copy -->
<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>UGC Prompt Generator - Data KTP</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="wrap">
    <div class="card">
      <span class="pill">ğŸ†” Data KTP Karakter</span>
      <h1>ğŸš€ Data KTP Karakter</h1>
      <p class="sub">Ini data KTP karakter yang akan digunakan untuk konsistensi video. Input data dulu di Manage Data sebelum generate prompt. Klik Copy untuk copy data KTP dalam bahasa Inggris (siap kirim ke TTV).</p>

      <!-- Arahan untuk TTV -->
      <div class="example">
        <strong>ğŸ’¡ Arahan untuk TTV</strong>
        Kirim data KTP ini ke TTV untuk konsistensi karakter di semua video. Pastikan karakter selalu menggunakan atribut fisik, pakaian, suara, dan gaya visual yang sama di setiap prompt.
      </div>

      <!-- List Data KTP (dalam English) -->
      <div class="hr"></div>
      <label>ğŸ“‹ Data KTP dari Google Sheets (dalam Bahasa Inggris)</label>
      <div id="ktp_list" class="example">
        <!-- Data akan muncul di sini -->
      </div>

      <div class="hr"></div>

      <div class="actions">
        <button class="btn" onclick="copyKTP()">ğŸ“‹ Copy Data KTP (English)</button>
        <button class="btn ghost" onclick="window.location.href='crud.html'">ğŸ—‚ï¸ Manage Data</button>
        <button class="btn alt" onclick="window.location.href='prompt_ttv.html'">âœ¨ Generate Prompt</button>
      </div>

      <p class="muted">Flow: Input data di Manage Data â†’ Copy KTP â†’ Generate Prompt â†’ Kirim ke TTV ğŸŒŸ</p>
    </div>
  </div>

<script>
const GAS_URL = 'https://script.google.com/macros/s/AKfycbwmDzp1ifdkngq3e24lz_w1r5ZlnKH2yQtck_TFS8P_e7gQJI4fi4U1b6t15PTKFS6GiA/exec';

let ktpData = [];

function loadKTPData(){
  const xhr = new XMLHttpRequest();
  xhr.open('GET', GAS_URL + '?action=getData', true);
  xhr.onreadystatechange = function() {
    if (xhr.readyState === 4) {
      if (xhr.status === 200) {
        try {
          const response = JSON.parse(xhr.responseText);
          if (response.error) {
            alert('Error from GAS: ' + response.error);
            return;
          }
          ktpData = response;
          renderKTPList();
        } catch (e) {
          alert('Error parsing data: ' + e.message);
        }
      } else {
        alert('Error loading data: ' + xhr.status);
      }
    }
  };
  xhr.send();
}

function renderKTPList(){
  const list = document.getElementById('ktp_list');
  list.innerHTML = '';
  if(ktpData.length === 0){
    list.innerHTML = '<p>Tidak ada data KTP. Klik Manage Data untuk input dulu.</p>';
    return;
  }
  ktpData.forEach((item, index) => {
    list.innerHTML += `
      <div style="border-bottom: 1px solid #e5e7eb; padding: 8px 0;">
        <strong>Character ID:</strong> ${item.char_id || 'Empty'}<br/>
        <strong>Physical Attributes:</strong> ${item.attr_fisik || 'Empty'}<br/>
        <strong>Clothing:</strong> ${item.cloth_id || 'Empty'}<br/>
        <strong>Voice:</strong> ${item.voice_id || 'Empty'}<br/>
        <strong>Visual Style:</strong> ${item.style_id || 'Empty'}
      </div>
    `;
  });
}

function copyKTP(){
  let text = 'Character KTP Data (for TTV consistency):\n';
  ktpData.forEach((item, index) => {
    text += `\nCharacter ID: ${item.char_id || 'Empty'}\n`;
    text += `Physical Attributes: ${item.attr_fisik || 'Empty'}\n`;
    text += `Clothing: ${item.cloth_id || 'Empty'}\n`;
    text += `Voice: ${item.voice_id || 'Empty'}\n`;
    text += `Visual Style: ${item.style_id || 'Empty'}\n`;
  });
  navigator.clipboard.writeText(text).then(() => {
    alert('Data KTP berhasil dicopy dalam bahasa Inggris! ğŸ“‹');
  }).catch(err => {
    alert('Gagal copy: ' + err);
  });
}

// Auto load data saat halaman buka
window.onload = function() {
  loadKTPData();
};
</script>
</body>
</html>
