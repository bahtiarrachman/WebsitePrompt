<!-- prompt_ttv.html - Kode Lengkap dengan Update LoadCharDetails -->
<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Generate Prompt TTV</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="wrap">
    <div class="card">
      <span class="pill">ğŸ¥ Generate Prompt TTV</span>
      <h1>ğŸš€ Generate Prompt TTV</h1>
      <p class="sub">Isi pelan-pelan. Pilih ID Karakter untuk konsistensi. Klik Generate â†’ Copy. âœ¨</p>

      <div class="grid">
        <!-- PRESET -->
        <div>
          <label>ğŸ‘¤ Preset Karakter</label>
          <select id="preset" onchange="applyPreset()">
            <option value="default">Default (Umum)</option>
            <option value="muslimah">Muslimah (Bicara)</option>
            <option value="muslimah_silent">Muslimah Silent (Tanpa Dialog)</option>
            <option value="other">Lainnya</option>
          </select>
          <input type="text" id="preset_other" class="hidden" placeholder="Deskripsikan karakter (dalam bahasa Inggris)" />
          <div class="hint">
            Pilih tipe karakter. Kalau ragu, pilih <b>Muslimah</b>. Untuk "Lainnya", isi deskripsi manual.
          </div>
        </div>

        <!-- ID KARAKTER (dari data GAS) -->
        <div>
          <label>ğŸ†” Pilih ID Karakter (dari Data)</label>
          <select id="char_select" onchange="loadCharDetails()">
            <option value="">Pilih ID...</option>
            <!-- Akan diisi otomatis dari loadCharData -->
          </select>
          <div class="hint">
            Pilih ID karakter dari database untuk konsistensi. Detail akan otomatis isi ke prompt.
          </div>
        </div>

        <!-- USIA -->
        <div>
          <label>ğŸ‚ Usia (rentang)</label>
          <input id="age" placeholder="contoh: 22â€“30 tahun" />
          <div class="hint">
            Gunakan <b>rentang umur</b>, bukan satu angka.
          </div>
        </div>

        <!-- LOKASI -->
        <div>
          <label>ğŸ  Lokasi Pengambilan Video</label>
          <input id="location" placeholder="contoh: dekat jendela ruang tamu" />
          <div class="hint">
            Lokasi rumah asli. Bukan studio, bukan green screen.
          </div>
        </div>

        <!-- FOKUS -->
        <div>
          <label>ğŸ“· Fokus Kamera</label>
          <select id="focus" onchange="applyFocus()">
            <option value="wajah">wajah</option>
            <option value="wajah + produk">wajah + produk</option>
            <option value="other">Lainnya</option>
          </select>
          <input type="text" id="focus_other" class="hidden" placeholder="Deskripsikan fokus (dalam bahasa Inggris)" />
          <div class="hint">
            Testimoni â†’ wajah. Jualan halus â†’ wajah + produk. Untuk "Lainnya", isi deskripsi manual.
          </div>
        </div>

        <!-- DIALOG -->
        <div class="grid-1">
          <label>ğŸ’¬ Dialog (opsional)</label>
          <textarea id="dialog" placeholder="Kosongkan jika memilih Silent"></textarea>
          <div class="hint">
            1 kalimat pendek, jujur, tidak hard selling. (Tetap dalam bahasa asli, tidak diterjemahkan di prompt).
          </div>
        </div>
      </div>

      <div class="example">
        <strong>ğŸ’¡ Contoh Dialog yang Bagus</strong>
        - â€œAwalnya aku ragu, tapi ternyata kepake banget.â€<br/>
        - â€œBuat aku ini simpel, tapi ngebantu.â€<br/>
        - â€œAku pakai beberapa hari, hasilnya kerasa.â€
      </div>

      <div class="hr"></div>

      <div class="actions">
        <button class="btn" onclick="generate()">âœ¨ Generate Prompt</button>
        <button class="btn alt" onclick="copy()">ğŸ“‹ Copy Prompt</button>
        <button class="btn ghost" onclick="fillExample()">ğŸ”„ Isi Contoh Otomatis</button>
        <button class="btn ghost" onclick="resetForm()">ğŸ—‘ï¸ Reset</button>
        <button class="btn ghost" onclick="window.location.href='index.html'">ğŸ  Kembali ke Home</button>
      </div>

      <div class="hr"></div>

      <label>ğŸ“ Prompt Final (siap copy)</label>
      <textarea id="result" placeholder="Hasil akan muncul di sini..."></textarea>
      <p class="muted">No cinematic â€¢ no filter â€¢ natural UGC look ğŸŒŸ</p>
    </div>
  </div>

<script>
// Tambah variabel dan fungsi untuk load data karakter
let charData = [];
const GAS_URL = 'https://script.google.com/macros/s/AKfycbwmDzp1ifdkngq3e24lz_w1r5ZlnKH2yQtck_TFS8P_e7gQJI4fi4U1b6t15PTKFS6GiA/exec';

function loadCharData(){
  const xhr = new XMLHttpRequest();
  xhr.open('GET', GAS_URL + '?action=getData', true);
  xhr.onreadystatechange = function() {
    if (xhr.readyState === 4) {
      if (xhr.status === 200) {
        try {
          const response = JSON.parse(xhr.responseText);
          if (response.error) {
            console.log('Error from GAS: ' + response.error);
            return;
          }
          charData = response;
          updateCharSelect();
        } catch (e) {
          console.log('Error parsing char data: ' + e.message);
        }
      } else {
        console.log('Error loading char data: ' + xhr.status);
      }
    }
  };
  xhr.send();
}

function updateCharSelect(){
  const select = document.getElementById('char_select');
  select.innerHTML = '<option value="">Pilih ID...</option>';
  charData.forEach((item, index) => {
    if(item.char_id){
      select.innerHTML += `<option value="${index}">${item.char_id}</option>`;
    }
  });
}

function loadCharDetails(){
  const selectedIndex = document.getElementById('char_select').value;
  if(selectedIndex !== ''){
    const item = charData[selectedIndex];
    // Gabung detail ke preset_other untuk konsistensi
    const details = (item.attr_fisik ? item.attr_fisik + '. ' : '') +
                    (item.cloth_id ? item.cloth_id + '. ' : '') +
                    (item.voice_id ? item.voice_id + '. ' : '') +
                    (item.style_id ? item.style_id + '. ' : '');
    document.getElementById('preset_other').value = details.trim();
    document.getElementById('preset').value = 'other';
    applyPreset();
  }
}

// Auto load char data saat halaman buka
window.onload = function() {
  loadCharData();
};

function applyPreset(){
  const p = document.getElementById('preset').value;
  const d = document.getElementById('dialog');
  const po = document.getElementById('preset_other');
  if(p === 'muslimah'){
    d.placeholder = 'contoh: Awalnya aku ragu, tapi ternyata kepake banget.';
    po.classList.add('hidden');
  } else if(p === 'muslimah_silent'){
    d.value = '';
    d.placeholder = 'Tidak digunakan (silent)';
    po.classList.add('hidden');
  } else if(p === 'other'){
    po.classList.remove('hidden');
  } else {
    po.classList.add('hidden');
  }
}

function applyFocus(){
  const f = document.getElementById('focus').value;
  const fo = document.getElementById('focus_other');
  if(f === 'other'){
    fo.classList.remove('hidden');
  } else {
    fo.classList.add('hidden');
  }
}

function fillExample(){
  document.getElementById('preset').value = 'muslimah';
  document.getElementById('age').value = '22â€“30 tahun';
  document.getElementById('location').value = 'dekat jendela ruang tamu rumah';
  document.getElementById('focus').value = 'wajah';
  document.getElementById('dialog').value = 'Awalnya aku ragu, tapi ternyata kepake banget.';
  applyPreset();
  applyFocus();
}

function generate(){
  const preset = document.getElementById('preset').value;
  const preset_other = document.getElementById('preset_other').value;
  const age = document.getElementById('age').value || '[usia]';
  const location = document.getElementById('location').value || '[lokasi rumah]';
  const focus = document.getElementById('focus').value;
  const focus_other = document.getElementById('focus_other').value;
  const dialog = document.getElementById('dialog').value;

  let txt = '';
  txt += 'A realistic UGC portrait-style vertical video (9:16). ';
  txt += 'A close-up talking-head shot of an Indonesian woman aged ' + age + ', ';
  txt += 'recorded using a smartphone front camera. ';
  txt += 'Focus on ' + (focus === 'other' ? focus_other : focus) + '. ';
  txt += 'The scene takes place in a real home environment at ' + location + ', ';
  txt += 'lit by natural daylight from a nearby window. ';

  if(preset === 'muslimah'){
    txt += 'She wears a modest gamis with hijab fully covering her hair. ';
    txt += 'She speaks naturally to the camera with calm, honest expressions. ';
  } else if(preset === 'muslimah_silent'){
    txt += 'She wears a modest gamis with hijab fully covering her hair. ';
    txt += 'She does not speak; no mouth movement. Calm, natural expressions only. ';
  } else if(preset === 'other'){
    txt += preset_other + '. '; // Include detail dari data GAS
    txt += 'The person speaks naturally with honest facial expressions. ';
  } else {
    txt += 'The person speaks naturally with honest facial expressions. ';
  }

  if(dialog && preset !== 'muslimah_silent'){
    txt += 'Dialogue spoken naturally: "' + dialog + '". ';
  }

  txt += 'No cinematic lighting, no beauty filters, no studio setup, ';
  txt += 'no background music, no text overlay, no watermark. ';
  txt += 'The video feels authentic, personal, and trustworthy.';

  document.getElementById('result').value = txt;
}

function copy(){
  const t = document.getElementById('result');
  t.select(); document.execCommand('copy');
  alert('Prompt berhasil dicopy! ğŸ‰');
}

function resetForm(){
  ['age','location','dialog','result','preset_other','focus_other'].forEach(id=>document.getElementById(id).value='');
  document.getElementById('preset').value='default';
  document.getElementById('focus').value='wajah';
  document.getElementById('char_select').value = '';
  applyPreset();
  applyFocus();
}
</script>
</body>
</html>